package adapters;

import APIs.openWeatherAPI;
import concreteClasses.utility.StringManager;
import concreteClasses.WeatherData;
import interfaces.IweatherInfoProvider;
import org.json.JSONArray;
import org.json.JSONObject;

public class OpenWeatherAdapter implements IweatherInfoProvider {
    openWeatherAPI api;
    private JSONObject allInfo;
    public OpenWeatherAdapter(){
        api = new openWeatherAPI("e3dfd49f7917fe082f153b64f7ab41b9");
    }
    public WeatherData getWeatherData(String  location){
        StringManager stringManager = new StringManager();
        allInfo = api.fetchData(stringManager.fillSpaceWithSymbol(location));
        return parseInfotoWeatherData();

    }
    public WeatherData parseInfotoWeatherData(){
        try{
            if(allInfo == null){
                throw new RuntimeException("Info not fetched yet");
            }
            JSONObject coord = allInfo.getJSONObject("coord");
            JSONObject main = allInfo.getJSONObject("main");
            JSONArray weatherArray = allInfo.getJSONArray("weather");
            JSONObject weather = weatherArray.getJSONObject(0); // First element in the array
